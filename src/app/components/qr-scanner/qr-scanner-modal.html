<div class="p-4">
    @if (!scannedText) {
        <div class="scanner-area">
            <ngx-scanner-qrcode #scanner="scanner" [isBeep]="true" [vibrate]="300"></ngx-scanner-qrcode>
            <div class="mt-3 text-sm text-gray-500">Aponte a câmera para o QR Code</div>
            <div class="mt-2 text-xs text-gray-400">Se for solicitado permissão, permita o uso da câmera.</div>
        </div>
    }
    @else {
        <div class="scanned-area">
            @if (loading) {
                <div class="mt-4 text-sm text-gray-600">Processando o token...</div>
            }

            @if (errorMsg) {
                <div class="mt-4 text-sm text-red-600">{{ errorMsg }}</div>
                <div class="mt-4 flex gap-3"><button nz-button (click)="close()">Fechar</button></div>
            }

            @if (!loading && redeemedStamps.length > 0) {
                <div class="mt-4">
                    <div class="text-sm font-semibold">Selos resgatados</div>
                    <ul class="mt-2 grid grid-cols-5 gap-2">
                        @for (s of redeemedStamps; track s.id) {
                            <li class="w-full h-12 bg-white rounded-md border overflow-hidden flex items-center justify-center">
                                @if (s?.stamp?.image) {
                                    <img src="{{ s.stamp.image }}" alt="Selo" class="w-full h-full object-contain" />
                                }
                                @else {
                                    <i class="ph ph-stamp text-2xl text-gray-300"></i>
                                }
                            </li>
                        }
                    </ul>
                    <div class="mt-4 flex gap-3">
                        <button nz-button nzType="primary" (click)="confirm()">Fechar</button>
                    </div>
                </div>
            }

            @if (!loading && redeemedStamps.length === 0 && !errorMsg) {
                <div class="mt-4 flex gap-3">
                    <button nz-button nzType="primary" (click)="confirm()">Usar</button>
                    <button nz-button (click)="close()">Fechar</button>
                </div>
            }
        </div>
    }
</div>
