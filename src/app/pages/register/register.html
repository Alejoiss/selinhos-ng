<div class="h-full bg-brand ">
    <a [routerLink]="['/']" class="flex flex-row items-center justify-center py-4 gap-4 mb-10">
        <img src="assets/images/logo.svg" alt="Logo Selo Clube" class="h-12" />
        <span class="text-white text-center text-4xl">Selo Clube</span>
    </a>
</div>

<div class="flex items-center justify-center font-sans">

    <div class="w-full max-w-lg px-8">

        <h1 class="text-center text-lg font-semibold mb-8">Cadastro de consumidores</h1>
        <h1 class="text-center text-lg font-semibold mb-8">Dados de acesso</h1>

        <form class="space-y-4" [formGroup]="form" (ngSubmit)="onSubmit()">

            <!-- CPF -->
            <div>
                <label for="cpf" class="block text-sm font-semibold mb-1">CPF (login)</label>
                <input type="text" id="cpf" name="cpf" placeholder="000.000.000-00" mask="000.000.000-00" formControlName="cpf"
                    class="w-full rounded-md px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:outline-none"
                    [ngClass]="{
                        'border border-red-500': cpfExists === true,
                        'border border-green-500': cpfExists === false,
                        'border border-gray-400': cpfExists === null
                    }">
                @if (cpfExists === true) {
                    <span class="text-sm text-red-500 mt-1 block">Esse CPF já está em uso.</span>
                }
                @else if (cpfExists === false) {
                    <span class="text-sm text-green-500 mt-1 block">CPF disponível.</span>
                }
                @else {
                    <span class="text-sm text-gray-500 mt-1 block">Use seu CPF como login. Ex: 000.000.000-00</span>
                }
            </div>

            <!-- Nome e Sobrenome -->
            <div class="flex flex-col space-y-4 md:flex-row md:space-x-4 md:space-y-0">
                <div class="flex-1">
                    <label for="nome" class="block text-sm font-semibold mb-1">Nome</label>
                    <input type="text" id="nome" name="nome" placeholder="José" formControlName="first_name"
                        class="w-full border border-gray-400 rounded-md px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:outline-none">
                </div>
                <div class="flex-1">
                    <label for="sobrenome" class="block text-sm font-semibold mb-1">Sobrenome</label>
                    <input type="text" id="sobrenome" name="sobrenome" placeholder="da Silva" formControlName="last_name"
                        class="w-full border border-gray-400 rounded-md px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:outline-none">
                </div>
            </div>

            <!-- E-mail -->
            <div>
                <label for="email" class="block text-sm font-semibold mb-1">E-mail</label>
                <input type="email" id="email" placeholder="seuemail@email.com" formControlName="email"
                    class="w-full rounded-md px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:outline-none"
                    [ngClass]="{
                        'border border-red-500': emailExists === true,
                        'border border-green-500': emailExists === false,
                        'border border-gray-400': emailExists === null
                    }">
                @if (emailExists === true) {
                    <span class="text-sm text-red-500 mt-1 block">Esse e-mail já está em uso.</span>
                }
                @else if (emailExists === false) {
                    <span class="text-sm text-green-500 mt-1 block">E-mail disponível.</span>
                }
                @else {
                    <span class="text-sm text-gray-500 mt-1 block">Digite um e-mail válido para contato.</span>
                }
            </div>

            <!-- Handle -->
            <div>
                <label for="handle" class="block text-sm font-semibold mb-1">Identificador de usuário</label>
                <div class="flex w-full">
                    <div
                        class="inline-flex items-center px-3 py-2 border border-r-0 border-gray-400 bg-gray-100 text-gray-700 rounded-l-md"[ngClass]="{
                            'border-red-500': handleExists === true,
                            'border-gray-400': handleExists === null,
                            'border-green-500': handleExists === false
                        }">
                        @
                    </div>
                    <input type="text" id="handle" placeholder="seuusuario" formControlName="handle"
                        class="flex-1 border border-l-0 border-gray-400 rounded-r-md px-3 py-2 !outline-none" [ngClass]="{
                            'border-red-500': handleExists === true,
                            'border-gray-400': handleExists === null,
                            'border-green-500': handleExists === false
                        }">
                </div>
                @if (form.get('handle')?.invalid && form.get('handle')?.touched) {
                    <span class="text-sm text-red-500 mt-1 block">
                        O identificador deve conter apenas letras, números, pontos e underscores, sem espaços.
                    </span>
                }
                @else {
                    @if (handleExists === true) {
                        <span class="text-sm text-red-500 mt-1 block">
                            Este identificador já está em uso. Por favor, escolha outro.
                        </span>
                    }
                    @else if (handleExists === false) {
                        <span class="text-sm text-green-500 mt-1 block">
                            Este identificador está disponível!
                        </span>
                    }
                    @else {
                        <span class="text-sm text-gray-500 mt-1 block">
                            Escolha um identificador único para sua conta. Ex: @joaosilva
                        </span>
                    }
                }
            </div>

            <!-- Celular e Data de nascimento -->
            <div class="flex flex-col space-y-4 md:flex-row md:space-x-4 md:space-y-0">
                <div class="flex-1">
                    <label for="celular" class="block text-sm font-semibold mb-1">Celular</label>
                    <input type="tel" id="celular" name="celular" placeholder="(00) 00000-0000" mask="(00) 00000-0000" formControlName="cellphone"
                        class="w-full border border-gray-400 rounded-md px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:outline-none">
                </div>
                <div class="flex-1">
                    <label for="birtday" class="block text-sm font-semibold mb-1">Data de Nascimento</label>
                    <input type="date" id="birtday" name="birtday" placeholder="DD/MM/AAAA" formControlName="birthday" lang="pt-BR"
                        class="w-full border border-gray-400 rounded-md px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:outline-none">
                </div>
            </div>

            <!-- Senha -->
            <div class="relative">
                <label for="senha" class="block text-sm font-semibold mb-1">Senha</label>
                <input [type]="passwordVisible ? 'text' : 'password'" id="senha" name="senha" placeholder="********" formControlName="password"
                    class="w-full border border-gray-400 rounded-md px-3 py-2 focus:ring-2 focus:ring-purple-500 focus:outline-none">
                <span (click)="passwordVisible = !passwordVisible"
                    class="cursor-pointer text-gray-500 hover:text-purple-600 transition-colors duration-200 absolute right-3 top-8">
                    <i [ngClass]="passwordVisible ? 'ph ph-eye-slash' : 'ph ph-eye'"></i>
                </span>
            </div>

            <!-- Botão -->
            <div class="text-center pt-4 flex flex-col gap-4 items-center w-full mb-4">
                <label class="flex items-center gap-3 text-sm text-color-primary w-full">
                    <input type="checkbox" formControlName="accepted_terms" class="mt-1" />
                    <span>Aceito os termos e condições. <a href="#" (click)="openTerms($event)" class="text-color-primary !underline">Veja aqui os termos</a></span>
                </label>

                <button type="submit" [disabled]="form.invalid || addingUser || emailExists || cpfExists || handleExists"
                    [ngClass]="form.invalid || addingUser || emailExists || cpfExists || handleExists ?
                        'bg-gray-400 cursor-not-allowed' : 'bg-brand bg-brand-hover text-color-primary cursor-pointer !text-white'"
                    class="font-medium !rounded-xl !py-2 w-full">
                    @if (addingUser) {
                        <i class="ph ph-spinner animate-spin text-base align-middle"></i>
                    }
                    @else {
                        Cadastrar
                    }
                </button>

                <a [routerLink]="['/login']" class="text-sm text-purple-600 hover:underline">Já tem uma conta? Faça login</a>

                <a [routerLink]="['/']" class="text-sm text-purple-600 hover:underline">Voltar ao site</a>
            </div>
        </form>
    </div>
</div>
